name: ì£¼ê°„ ë¡œë˜ ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸

on:
  schedule:
    # ë§¤ì£¼ í† ìš”ì¼ ì˜¤í›„ 9ì‹œ (í•œêµ­ì‹œê°„ ê¸°ì¤€, UTC+9ì´ë¯€ë¡œ 12ì‹œë¡œ ì„¤ì •)
    - cron: '0 12 * * 6'
  workflow_dispatch: # ìˆ˜ë™ ì‹¤í–‰ë„ ê°€ëŠ¥

jobs:
  update-lotto-data:
    runs-on: ubuntu-latest
    
    steps:
    - name: ì €ì¥ì†Œ ì²´í¬ì•„ì›ƒ
      uses: actions/checkout@v4
      with:
        token: ${{ secrets.GITHUB_TOKEN }}

    - name: Python í™˜ê²½ ì„¤ì •
      uses: actions/setup-python@v4
      with:
        python-version: '3.x'

    - name: Python ì˜ì¡´ì„± ì„¤ì¹˜
      run: |
        python -m pip install --upgrade pip
        pip install requests pandas openpyxl

    - name: ìµœì‹  ë¡œë˜ ë²ˆí˜¸ ê°€ì ¸ì˜¤ê¸° ë° JSON ì—…ë°ì´íŠ¸
      run: |
        python scripts/update-lotto-data.py

    - name: ë³€ê²½ì‚¬í•­ í™•ì¸
      id: check_changes
      run: |
        if git diff --quiet; then
          echo "changes=false" >> $GITHUB_OUTPUT
        else
          echo "changes=true" >> $GITHUB_OUTPUT
        fi

    - name: ë³€ê²½ì‚¬í•­ ì»¤ë°‹ ë° í‘¸ì‹œ
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        git config --local user.email "action@github.com"
        git config --local user.name "GitHub Action"
        git add .
        git commit -m "ğŸ¤– ë¡œë˜ ë°ì´í„° ìë™ ì—…ë°ì´íŠ¸ $(date +'%Y-%m-%d %H:%M:%S')

        ğŸ“Š ìƒˆë¡œìš´ íšŒì°¨ ë°ì´í„° ì¶”ê°€
        ğŸ”„ í†µê³„ ë°ì´í„° ìë™ ê°±ì‹ 
        
        ğŸ¤– Generated with GitHub Actions
        Co-Authored-By: GitHub Action <action@github.com>"
        git push

    - name: ì—…ë°ì´íŠ¸ ì™„ë£Œ ì•Œë¦¼
      if: steps.check_changes.outputs.changes == 'true'
      run: |
        echo "âœ… ë¡œë˜ ë°ì´í„°ê°€ ì„±ê³µì ìœ¼ë¡œ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤!"
        echo "ğŸ“… ì—…ë°ì´íŠ¸ ì‹œê°„: $(date +'%Y-%m-%d %H:%M:%S')"

    - name: ë³€ê²½ì‚¬í•­ ì—†ìŒ ì•Œë¦¼
      if: steps.check_changes.outputs.changes == 'false'
      run: |
        echo "â„¹ï¸ ìƒˆë¡œìš´ ë¡œë˜ ë°ì´í„°ê°€ ì—†ìŠµë‹ˆë‹¤."
        echo "ğŸ“… í™•ì¸ ì‹œê°„: $(date +'%Y-%m-%d %H:%M:%S')"